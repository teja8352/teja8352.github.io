"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4540],{4540:(b,d,i)=>{i.r(d),i.d(d,{ChatPageModule:()=>S});var r=i(6895),u=i(433),o=i(2346),h=i(9461),c=i(744),e=i(8274),m=i(9244),f=i(9763);const p=function(n){return{"ion-text-end":n}};function C(n,l){if(1&n&&(e.TgZ(0,"ion-col",13)(1,"ion-item",14)(2,"ion-label",15)(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"p",16),e._uU(6),e.ALo(7,"date"),e.qZA()()()()),2&n){const t=l.$implicit;e.Q6J("offset",null!=t&&t.is_student?0:3)("offsetMd",null!=t&&t.is_student?0:6)("offsetLg",null!=t&&t.is_student?0:7)("offsetXl",null!=t&&t.is_student?0:8),e.xp6(1),e.Q6J("color",null!=t&&t.is_student?"medium":"light"),e.xp6(3),e.Oqu(null==t?null:t.message),e.xp6(1),e.Q6J("ngClass",e.VKq(11,p,!(null!=t&&t.is_student))),e.xp6(1),e.hij(" ",e.xi3(7,8,null==t||null==t.created_at?null:t.created_at.toDate(),"dd MMM YYY hh:mm")," ")}}const M=[{path:"",component:(()=>{class n{constructor(t,s){this.dataService=t,this.commonService=s,this.chat=null,this.message=null,this.messages=[],this.messagesSubscriber=null,this.chat=JSON.parse(localStorage.getItem("chat")),this.messagesSubscriber=this.dataService.getMessages(this.chat?.id).subscribe(a=>{this.messages=a,this.updateScroll()},a=>{console.error("Error while getting messages::::::::::::\n",a)})}ngOnInit(){}ionViewWillEnter(){this.dataService.update(c.M.CHAT_ROOM,{unread_messages:0,id:this.chat?.id,is_opened:!0}).then(s=>{},s=>{console.error("Error while updating chat room:::::::::::\n",{...s})})}sendMessage(){this.message.trim().length<=0?this.message="":this.dataService.update(c.M.CHAT_ROOM,{last_msg:this.message,unread_messages:0,id:this.chat?.id}).then(s=>{const a={message:this.message,admin_id:localStorage.getItem("uid"),chat_id:this.chat?.id};this.dataService.add(c.M.MESSAGES,a).then(g=>{this.message="",this.updateScroll()},g=>{console.error("Error while adding message:::::::::::\n",g)})},s=>{console.error("Error while updating chat room:::::::::::\n",{...s})})}updateScroll(){setTimeout(()=>{this.content.scrollToBottom(1e3)},500)}ionViewWillLeave(){this.dataService.update(c.M.CHAT_ROOM,{id:this.chat?.id,is_opened:!1}).then(s=>{console.log("resp::::::::::::\n",s)},s=>{console.error("Error while updating chat room:::::::::::\n",{...s})})}ngOnDestroy(){this.messagesSubscriber.unsubscribe()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(m.D),e.Y36(f.v))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-chat"]],viewQuery:function(t,s){if(1&t&&e.Gf(o.W2,5),2&t){let a;e.iGM(a=e.CRH())&&(s.content=a.first)}},decls:20,vars:6,consts:[[3,"translucent"],["slot","start"],["icon","chevron-back-outline","defaultHref","chat-room"],["color","white",1,"ion-padding",3,"fullscreen"],["collapse","condense"],["size","large"],["size","9","size-md","6","size-lg","5","size-xl","4",3,"offset","offsetMd","offsetLg","offsetXl",4,"ngFor","ngForOf"],["color","light"],["lines","none","color","light",2,"--inner-padding-end","0"],["rows","1","autoGrow","true","placeholder","Enter message?....","maxlength","500",2,"max-height","100px",3,"ngModel","keyup.enter","ngModelChange"],["slot","end",1,"m-0"],["color","medium",3,"disabled","click"],["name","send","slot","icon-only"],["size","9","size-md","6","size-lg","5","size-xl","4",3,"offset","offsetMd","offsetLg","offsetXl"],["lines","none",1,"rounded","mb-1",3,"color"],[1,"ion-text-wrap"],[1,"m-0","size-12",3,"ngClass"]],template:function(t,s){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.qZA()()(),e.TgZ(6,"ion-content",3)(7,"ion-header",4)(8,"ion-toolbar")(9,"ion-title",5),e._uU(10,"Chat"),e.qZA()()(),e.TgZ(11,"ion-row"),e.YNc(12,C,8,13,"ion-col",6),e.qZA()(),e.TgZ(13,"ion-footer")(14,"ion-toolbar",7)(15,"ion-item",8)(16,"ion-textarea",9),e.NdJ("keyup.enter",function(){return s.sendMessage()})("ngModelChange",function(g){return s.message=g}),e.qZA(),e.TgZ(17,"ion-buttons",10)(18,"ion-button",11),e.NdJ("click",function(){return s.sendMessage()}),e._UZ(19,"ion-icon",12),e.qZA()()()()()),2&t&&(e.Q6J("translucent",!0),e.xp6(5),e.hij(" ",(null==s.chat?null:s.chat.student_name)||"Chat"," "),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(6),e.Q6J("ngForOf",s.messages),e.xp6(4),e.Q6J("ngModel",s.message),e.xp6(2),e.Q6J("disabled",!((null==s.message?null:s.message.length)>0)))},dependencies:[r.mk,r.sg,u.JJ,u.nD,u.On,o.oU,o.YG,o.Sm,o.wI,o.W2,o.fr,o.Gu,o.gu,o.Ie,o.Q$,o.Nd,o.g2,o.sr,o.wd,o.j9,o.cs,r.uU]}),n})()}];let v=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[h.Bz.forChild(M),h.Bz]}),n})(),S=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[r.ez,u.u5,o.Pc,v]}),n})()}}]);