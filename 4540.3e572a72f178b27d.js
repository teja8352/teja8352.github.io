"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4540],{4540:(b,u,i)=>{i.r(u),i.d(u,{ChatPageModule:()=>S});var l=i(6895),c=i(433),n=i(2346),h=i(9461),g=i(744),e=i(8274),m=i(9244),f=i(9763);const p=function(s){return{"ion-text-end":s}};function C(s,r){if(1&s&&(e.TgZ(0,"ion-col",13)(1,"ion-item",14)(2,"ion-label",15)(3,"p"),e._uU(4),e.qZA(),e.TgZ(5,"p",16),e._uU(6),e.ALo(7,"date"),e.qZA()()()()),2&s){const t=r.$implicit;e.Q6J("offset",t.is_student?0:3)("offsetMd",t.is_student?0:6)("offsetLg",t.is_student?0:7)("offsetXl",t.is_student?0:8),e.xp6(1),e.Q6J("color",t.is_student?"medium":"light"),e.xp6(3),e.Oqu(t.message),e.xp6(1),e.Q6J("ngClass",e.VKq(11,p,!t.is_student)),e.xp6(1),e.hij(" ",e.xi3(7,8,null==t.created_at?null:t.created_at.toDate(),"dd MMM YYY hh:mm")," ")}}const M=[{path:"",component:(()=>{class s{constructor(t,o){this.dataService=t,this.commonService=o,this.chat=null,this.message=null,this.messages=[],this.messagesSubscriber=null,this.chat=JSON.parse(localStorage.getItem("chat")),this.messagesSubscriber=this.dataService.getMessages(this.chat.id).subscribe(a=>{this.messages=a,this.updateScroll()},a=>{console.error("Error while getting messages::::::::::::\n",a)})}ngOnInit(){}ionViewWillEnter(){this.dataService.update(g.M.CHAT_ROOM,{unread_messages:0,id:this.chat.id,is_opened:!0}).then(o=>{},o=>{console.error("Error while updating chat room:::::::::::\n",{...o})})}sendMessage(){this.message.trim().length<=0?this.message="":this.dataService.update(g.M.CHAT_ROOM,{last_msg:this.message,unread_messages:0,id:this.chat.id}).then(o=>{console.log("resp::::::::::::\n",o);const a={message:this.message,admin_id:localStorage.getItem("uid"),chat_id:this.chat.id};this.dataService.add(g.M.MESSAGES,a).then(d=>{this.message="",this.updateScroll()},d=>{console.error("Error while adding message:::::::::::\n",d)})},o=>{console.error("Error while updating chat room:::::::::::\n",{...o})})}updateScroll(){setTimeout(()=>{this.content.scrollToBottom(1e3)},500)}ionViewWillLeave(){this.dataService.update(g.M.CHAT_ROOM,{id:this.chat.id,is_opened:!1}).then(o=>{console.log("resp::::::::::::\n",o)},o=>{console.error("Error while updating chat room:::::::::::\n",{...o})})}ngOnDestroy(){this.messagesSubscriber.unsubscribe()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(m.D),e.Y36(f.v))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-chat"]],viewQuery:function(t,o){if(1&t&&e.Gf(n.W2,5),2&t){let a;e.iGM(a=e.CRH())&&(o.content=a.first)}},decls:20,vars:6,consts:[[3,"translucent"],["slot","start"],["icon","chevron-back-outline","defaultHref","chat-room"],["color","white",1,"ion-padding",3,"fullscreen"],["collapse","condense"],["size","large"],["size","9","size-md","6","size-lg","5","size-xl","4",3,"offset","offsetMd","offsetLg","offsetXl",4,"ngFor","ngForOf"],["color","light"],["lines","none","color","light",2,"--inner-padding-end","0"],["rows","1","autoGrow","true","placeholder","Enter message....","maxlength","500",2,"max-height","100px",3,"ngModel","keyup.enter","ngModelChange"],["slot","end",1,"m-0"],["color","medium",3,"disabled","click"],["name","send","slot","icon-only"],["size","9","size-md","6","size-lg","5","size-xl","4",3,"offset","offsetMd","offsetLg","offsetXl"],["lines","none",1,"rounded","mb-1",3,"color"],[1,"ion-text-wrap"],[1,"m-0","size-12",3,"ngClass"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-back-button",2),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.qZA()()(),e.TgZ(6,"ion-content",3)(7,"ion-header",4)(8,"ion-toolbar")(9,"ion-title",5),e._uU(10,"Chat"),e.qZA()()(),e.TgZ(11,"ion-row"),e.YNc(12,C,8,13,"ion-col",6),e.qZA()(),e.TgZ(13,"ion-footer")(14,"ion-toolbar",7)(15,"ion-item",8)(16,"ion-textarea",9),e.NdJ("keyup.enter",function(){return o.sendMessage()})("ngModelChange",function(d){return o.message=d}),e.qZA(),e.TgZ(17,"ion-buttons",10)(18,"ion-button",11),e.NdJ("click",function(){return o.sendMessage()}),e._UZ(19,"ion-icon",12),e.qZA()()()()()),2&t&&(e.Q6J("translucent",!0),e.xp6(5),e.hij(" ",(null==o.chat?null:o.chat.student_name)||"Chat"," "),e.xp6(1),e.Q6J("fullscreen",!0),e.xp6(6),e.Q6J("ngForOf",o.messages),e.xp6(4),e.Q6J("ngModel",o.message),e.xp6(2),e.Q6J("disabled",!((null==o.message?null:o.message.length)>0)))},dependencies:[l.mk,l.sg,c.JJ,c.nD,c.On,n.oU,n.YG,n.Sm,n.wI,n.W2,n.fr,n.Gu,n.gu,n.Ie,n.Q$,n.Nd,n.g2,n.sr,n.wd,n.j9,n.cs,l.uU]}),s})()}];let v=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[h.Bz.forChild(M),h.Bz]}),s})(),S=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[l.ez,c.u5,n.Pc,v]}),s})()}}]);